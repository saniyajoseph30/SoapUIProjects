<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="903a616f-6595-4cd8-8483-9df17a509099" activeEnvironment="Default" name="REST Project -01.POST Request" resourceRoot="${projectDir}" soapui-version="5.7.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config">
  <con:settings/>
  <con:interface xsi:type="con:RestService" id="6fb6f5a8-dff4-4e8a-8127-25bb099d3b7c" wadlVersion="http://wadl.dev.java.net/2009/02" name="https://reqres.in" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://reqres.in</con:endpoint>
    </con:endpoints>
    <con:resource name="Users" path="/api/users" id="ca8d5407-62fe-431a-8606-e4c5e5c8e73e">
      <con:settings/>
      <con:parameters/>
      <con:method name="POST Request" id="adfb3b81-235d-4024-9786-1d0224dd48ae" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:representation type="REQUEST">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json; charset=utf-8</con:mediaType>
          <con:status>201</con:status>
          <con:params/>
          <con:element xmlns:user="https://reqres.in/api/users">user:Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>text/html; charset=utf-8</con:mediaType>
          <con:status>400</con:status>
          <con:params/>
          <con:element>html</con:element>
        </con:representation>
        <con:request name="Request 1" id="427c2263-d04f-4e61-8430-db65d0481438" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://reqres.in</con:endpoint>
          <con:request>{
    "name": "dharani",
    "job": "leader"
}</con:request>
          <con:originalUri>https://reqres.in/api/users</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
          <con:parameterOrder/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:testSuite id="4703d172-123c-4a69-b40d-a64ac4eb0e41" name="TestSuite Hardcoded values">
    <con:description>TestSuite generated for REST Service [https://reqres.in]</con:description>
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="dbb23952-8e2e-45f9-8359-6cde4140386b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase1_UserCreation" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="Users" id="46839bf7-b4ac-4085-a729-d940e519c7cd">
        <con:settings/>
        <con:config service="https://reqres.in" resourcePath="/api/users" methodName="POST Request" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Users" id="427c2263-d04f-4e61-8430-db65d0481438" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://reqres.in</con:endpoint>
            <con:request>{
    "Name": "Dharani",
    "Job": "IT-Profession",
    "Desingation" :"Project Leader",
    "Location": "Chennai"
}</con:request>
            <con:originalUri>https://reqres.in/api/users</con:originalUri>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties/>
    </con:testCase>
    <con:properties/>
    <con:tearDownScript><![CDATA[import java.util.Date
import java.text.SimpleDateFormat
import com.eviware.soapui.support.XmlHolder
SimpleDateFormat ft = new SimpleDateFormat ("dd-MM-yyyy_HHmmss");
SimpleDateFormat ftt = new SimpleDateFormat ("dd-MM-yyyy hh:mm:ss a");
String ProjectPath = context.expand('${projectDir}') + "\\" + testSuite.project.name + "\\"
String HTML_Starting = '<html><head><style>.tooltip{position:absolute;margin:5px;width:200px;height:50px;border:1px solid black;display:none;background-color: #FFFFFF}</style><script>function showTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "block";}function hideTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "none";}</script><script type="text/javascript" src="https://www.google.com/jsapi"></script>'               
String HTML_Ending   = '</body></html>'
String HTML_Body     = ''
String HTML_Final    = '';
int OPass = 0;
int OFail = 0;
int TotalCases = 0;
ArrayList<String> TC = new ArrayList<String>();
HashMap<String,String> BODY = new HashMap<String,String>()

log.info 'Start '+ runner.results

runner.results.each
{    testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
                TC.add(testCaseName)
}

Collections.sort(TC)
int TestcaseNO = 1;
runner.results.each

{   

  try{
                testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
     String testCaseName=testCaseName
     String testCaseDesc=testCaseResult.getTestCase().getDescription()
     String testCaseID = testCaseName
     if(testCaseID.contains('BUG'))testCaseID=testCaseID.split('\\[')[0]
     if(testCaseDesc==null||testCaseDesc=='')testCaseDesc=testCaseName
     //if(testCaseName.equalsIgnoreCase(testCaseDesc))testCaseID = 'TestCase '+TestcaseNO
     //TestcaseNO+=1;
	 
     log.info 'Test case result '+testCaseResult.getStatus()
                if(testCaseResult.getStatus().toString().contains("FINISHED")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else if(testCaseResult.getStatus().toString().contains("PASS")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else{
                                                String summarysize='50';
                                                String BUGS='';
                                                if(testCaseResult.getTestCase().name.toString().contains('BUG'))
                                                {
                                                                BUGS='<table>';
                                                                summarysize='40';
                                                                String Buglist = testCaseResult.getTestCase().name.toString().split('\\[')[1].split('\\]')[0];
                                                                ArrayList bugsl = new ArrayList();
                                                                if(Buglist.contains(','))bugsl=Buglist.split(',')
                                                                for(String bl : bugsl)
                                                                BUGS+='<tr><td><a target="_blank" href="https://ariasystems.atlassian.net/browse/'+bl+'">'+bl+'</a></td></tr>';
                                                                BUGS+='</table>';
                                                                BUGS='<TD width = "10%" bgcolor=white align="center" onmouseover="showTool(\'target'+testCaseName+'BUG(s)\');return false;" onmouseout="hideTool(\'target'+testCaseName+'BUG(s)\');return false;"><font color="red"><b>BUG(s)</b></font><div id="target'+testCaseName+'BUG(s)" style="display:none" class = "tooltip">'+BUGS+'</div></TD>';
                                                }
                                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#C20000" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "'+summarysize+'%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td>'+BUGS+'</tr></TABLE><div id="target'+testCaseName+'" style="display:none">';
                                                OFail+=1;
                     }

                int step=0;
                testCaseResult.getTestCase().testStepList.each
                {                             
                                String type=it.config.type
                                String StepName=it.name
          String req = '';
          String response    
                                if(type=="request"  || type=="httprequest" || type=="jdbc")

          {    step+=1;
                if(type=="request")
               {
               req  = it.getTestRequest().response.getRequestContent() ;
               response=it.getProperty('Response').getValue()
               }
               else if (type=="httprequest")
               {
                     String propFinal=''
                     def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password','Response','Username']
                     for (String p in it.getPropertyNames())
                     {
                                if(!propToRemove.contains(p) && it.getPropertyValue(p)!='')
                                                propFinal=propFinal+p +": "+it.getPropertyValue(p)+"\n"
                     }
                     req = propFinal.replaceAll(",","\n")
                     response=it.getProperty('Response').getValue()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
                response = it.getProperty('ResponseAsXml').getValue().toString()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
               def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password']
                    response = it.getProperty('ResponseAsXml').getValue().toString()
               }

               String StepResult = 'Passed'
               log.info  'Step results '+it.assertionStatus.toString()
               if(it.assertionStatus.toString().contains("UNKNOWN")){
              StepResult = '<td width="25%" align="center"><font color="orange"><b>No Assertion</b></font></TD>'
               } else if(it.assertionStatus.toString().contains("VALID"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
                else if(it.assertionStatus.toString().contains("PASS"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
               else
               StepResult = '<td width="25%" align="center"><font color="red"><b>Failed</b></font></TD>'
               HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "11%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td><td><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'ReqRes\');return false;" size ="1">Request/Response</a>&emsp;&emsp;&emsp;' + it.testRequest.response.timeTaken+'ms</TD>'+StepResult
                                                HTML_Body+='</TR></TABLE>'

                HTML_Body+='<div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                it.getAssertionList().each
                                {
                                myAssertion->
                                String aname="$myAssertion.label"
                                                                String astatus="$myAssertion.status"
                                                                String amsg=""
                                                                log.info 'Assertion Result '+ astatus
                                                                if (astatus.equals("VALID"))
                    {

                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                         {
                            //log.info "Dont do"
                         }
                     }else  if (astatus.equals("PASS"))
                    {
                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                                                    {
                            //log.info "Dont do"
                         }
                     }
                                                                else
                                                                {
                                                ares='<font color="red">Failed</font>'
                                                                                                amsg="$myAssertion.errors"
                                                                                                if(amsg.contains('expecting '))
                                                                                                                amsg='Expecting'+amsg.split('expecting')[1]
                                                                                amsg=amsg.replaceAll("actual was","Actual").replaceAll("]]","]");
                                                                }
                                                                HTML_Body+='<TR><TD width="7%">Assertion</TD><TD width="40%">'+aname+'</TD><TD align="center" width="10%">'+ares+'</TD><TD width="25%">'+amsg+'</TD></TR>'
                }
                HTML_Body+='</TABLE></div>'
                HTML_Body+='<div id="target'+testCaseName+'_'+step+'ReqRes\" style=\"display:none\"><TABLE align=\"center\" ID=\"One\" class= \"class_name\" bgcolor=\"#AFEEEE\" border width =\"80%\"  cellspacing = 0 cellpadding = 2  style = \"border-left:solid 2px White;\"><TR><TD width = "40%" size="4" valign="top"><font color="blue" size="2"><b>REQUEST</b></font><br><br><pre>'+req.replaceAll("\n&amp;=","").replaceAll("<","&lt;").replaceAll(">","&gt;")+'</pre></TD><TD width = "40%" size="4" valign="top" ><font color="blue" size="2"><b>RESPONSE</b></font><br><br><pre>'+response.replaceAll("><",">\n<").replaceAll("<","&lt;").replaceAll(">","&gt;")+' </TD></TR></TABLE></div>'
          }
          else if(type=="datagen")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td></tr></Table><div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                                for (String p in it.getPropertyNames())

                     {
                                HTML_Body+='<TR><TD width="10%">Created Data</TD><TD width="35%">'+p+'</TD><TD align="center" width="35%">'+it.getPropertyValue(p)+'</TD></TR>'
                     }
                                HTML_Body+='</TABLE></div></Table>'
                }
          else if(type=="groovy")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%">'+StepName+'</td></tr></Table>'
                }
                }

            
                }catch(Exception e){}
                HTML_Body+='</div>'
                BODY.put(testCaseName,HTML_Body)
                HTML_Body = '';
             
}

for(TCs in TC)

HTML_Body += BODY.get(TCs)

TotalCases = OPass+OFail;

String      HTMLTable = '<br><br><table width="35%" border="1" margin="10,5,5,50"  align="center"><tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total API cases Executed</th><th bgcolor="#fefefe" width="50%">'+TotalCases+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Passed</th><th bgcolor="#fefefe" width="50%">'+OPass+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Failed</th><th bgcolor="#fefefe" width="50%">'+OFail+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Environment</th><th bgcolor="#fefefe" width="50%">'+context.expand('${#TestSuite#Environment}')+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Execution Time</th><th bgcolor="#fefefe" width="50%">'+ftt.format(new Date())+'</th></tr></table>'
String HTML_Starting2='<title>'+testSuite.name+' Automation Report</title></head><script> function showDiv(objectID) { var theElementStyle = document.getElementById(objectID);  if(theElementStyle.style.display == "none")  { theElementStyle.style.display = "block";  } else { theElementStyle.style.display = "none"; }  }</script><body bgcolor="#FFFAFA"><h1 align="center">'+testSuite.name+' Automation Report</h1><div id="chart_div" style="float:left"></div>'+HTMLTable+'<table align="center" width="80%" class="Report"  bgcolor="#ADE6F1" border="1" margin="10,5,5,50"><tr><th width="80%">Test Execution Results</th></tr></table>'                 
HTML_Final = HTML_Starting+'<script type="text/javascript">google.load(\'visualization\', \'1.0\', {\'packages\':[\'corechart\']});  google.setOnLoadCallback(drawChart);function drawChart() {var data = new google.visualization.DataTable(); data.addColumn(\'string\', \'Result\'); data.addColumn(\'number\', \'Count\');data.addRows([[\'PASS\', '+OPass+'],[\'FAIL\', '+OFail+'],]); var options = {\'title\':\'Overall Result\', \'width\':500, \'height\':300, \'backgroundColor\':\'fefefe\', \'colors\': [\'#009933\', \'#F00000\'], \'fontSize\': 15};var chart = new google.visualization.PieChart(document.getElementById(\'chart_div\'));chart.draw(data, options);}</script>'+HTML_Starting2+HTML_Body+HTML_Ending

String Filename = testSuite.name+"_"+ft.format(new Date())+".html"
File file = new File(ProjectPath+Filename);
boolean blnDeleted = file.delete();
FileWriter writer = new FileWriter(ProjectPath+Filename, true);
writer.write(HTML_Final);
writer.close();
log.info 'Scenario Over']]></con:tearDownScript>
  </con:testSuite>
  <con:testSuite id="8188f764-349a-47b2-826a-eb86d64ed60d" name="TestSuite Random Values Generating">
    <con:description>TestSuite generated for REST Service [https://reqres.in]</con:description>
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="b918dae1-00f1-4a1b-8801-a8bf9b59f96c" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase1_UserCreation" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="Users" id="855593c0-5fcb-4ccc-92e7-e45135be3f03">
        <con:settings/>
        <con:config service="https://reqres.in" resourcePath="/api/users" methodName="POST Request" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Users" id="427c2263-d04f-4e61-8430-db65d0481438" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://reqres.in</con:endpoint>
            <con:request>{
    "Name": "${=org.apache.commons.lang.RandomStringUtils.randomAlphabetic(10)}",
    "Age": "${=org.apache.commons.lang.RandomStringUtils.randomNumeric(2)}",
    "Date" :"${=def now = new Date();now.format("yyyy-MM-dd")}"
}</con:request>
            <con:originalUri>https://reqres.in/api/users</con:originalUri>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties/>
    </con:testCase>
    <con:properties/>
    <con:tearDownScript><![CDATA[import java.util.Date
import java.text.SimpleDateFormat
import com.eviware.soapui.support.XmlHolder
SimpleDateFormat ft = new SimpleDateFormat ("dd-MM-yyyy_HHmmss");
SimpleDateFormat ftt = new SimpleDateFormat ("dd-MM-yyyy hh:mm:ss a");
String ProjectPath = context.expand('${projectDir}') + "\\" + testSuite.project.name + "\\"
String HTML_Starting = '<html><head><style>.tooltip{position:absolute;margin:5px;width:200px;height:50px;border:1px solid black;display:none;background-color: #FFFFFF}</style><script>function showTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "block";}function hideTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "none";}</script><script type="text/javascript" src="https://www.google.com/jsapi"></script>'               
String HTML_Ending   = '</body></html>'
String HTML_Body     = ''
String HTML_Final    = '';
int OPass = 0;
int OFail = 0;
int TotalCases = 0;
ArrayList<String> TC = new ArrayList<String>();
HashMap<String,String> BODY = new HashMap<String,String>()

log.info 'Start '+ runner.results

runner.results.each
{    testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
                TC.add(testCaseName)
}

Collections.sort(TC)
int TestcaseNO = 1;
runner.results.each

{   

  try{
                testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
     String testCaseName=testCaseName
     String testCaseDesc=testCaseResult.getTestCase().getDescription()
     String testCaseID = testCaseName
     if(testCaseID.contains('BUG'))testCaseID=testCaseID.split('\\[')[0]
     if(testCaseDesc==null||testCaseDesc=='')testCaseDesc=testCaseName
     //if(testCaseName.equalsIgnoreCase(testCaseDesc))testCaseID = 'TestCase '+TestcaseNO
     //TestcaseNO+=1;
	 
     log.info 'Test case result '+testCaseResult.getStatus()
                if(testCaseResult.getStatus().toString().contains("FINISHED")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else if(testCaseResult.getStatus().toString().contains("PASS")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else{
                                                String summarysize='50';
                                                String BUGS='';
                                                if(testCaseResult.getTestCase().name.toString().contains('BUG'))
                                                {
                                                                BUGS='<table>';
                                                                summarysize='40';
                                                                String Buglist = testCaseResult.getTestCase().name.toString().split('\\[')[1].split('\\]')[0];
                                                                ArrayList bugsl = new ArrayList();
                                                                if(Buglist.contains(','))bugsl=Buglist.split(',')
                                                                for(String bl : bugsl)
                                                                BUGS+='<tr><td><a target="_blank" href="https://ariasystems.atlassian.net/browse/'+bl+'">'+bl+'</a></td></tr>';
                                                                BUGS+='</table>';
                                                                BUGS='<TD width = "10%" bgcolor=white align="center" onmouseover="showTool(\'target'+testCaseName+'BUG(s)\');return false;" onmouseout="hideTool(\'target'+testCaseName+'BUG(s)\');return false;"><font color="red"><b>BUG(s)</b></font><div id="target'+testCaseName+'BUG(s)" style="display:none" class = "tooltip">'+BUGS+'</div></TD>';
                                                }
                                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#C20000" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "'+summarysize+'%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td>'+BUGS+'</tr></TABLE><div id="target'+testCaseName+'" style="display:none">';
                                                OFail+=1;
                     }

                int step=0;
                testCaseResult.getTestCase().testStepList.each
                {                             
                                String type=it.config.type
                                String StepName=it.name
          String req = '';
          String response    
                                if(type=="request"  || type=="httprequest" || type=="jdbc")

          {    step+=1;
                if(type=="request")
               {
               req  = it.getTestRequest().response.getRequestContent() ;
               response=it.getProperty('Response').getValue()
               }
               else if (type=="httprequest")
               {
                     String propFinal=''
                     def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password','Response','Username']
                     for (String p in it.getPropertyNames())
                     {
                                if(!propToRemove.contains(p) && it.getPropertyValue(p)!='')
                                                propFinal=propFinal+p +": "+it.getPropertyValue(p)+"\n"
                     }
                     req = propFinal.replaceAll(",","\n")
                     response=it.getProperty('Response').getValue()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
                response = it.getProperty('ResponseAsXml').getValue().toString()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
               def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password']
                    response = it.getProperty('ResponseAsXml').getValue().toString()
               }

               String StepResult = 'Passed'
               log.info  'Step results '+it.assertionStatus.toString()
               if(it.assertionStatus.toString().contains("UNKNOWN")){
              StepResult = '<td width="25%" align="center"><font color="orange"><b>No Assertion</b></font></TD>'
               } else if(it.assertionStatus.toString().contains("VALID"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
                else if(it.assertionStatus.toString().contains("PASS"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
               else
               StepResult = '<td width="25%" align="center"><font color="red"><b>Failed</b></font></TD>'
               HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "11%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td><td><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'ReqRes\');return false;" size ="1">Request/Response</a>&emsp;&emsp;&emsp;' + it.testRequest.response.timeTaken+'ms</TD>'+StepResult
                                                HTML_Body+='</TR></TABLE>'

                HTML_Body+='<div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                it.getAssertionList().each
                                {
                                myAssertion->
                                String aname="$myAssertion.label"
                                                                String astatus="$myAssertion.status"
                                                                String amsg=""
                                                                log.info 'Assertion Result '+ astatus
                                                                if (astatus.equals("VALID"))
                    {

                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                         {
                            //log.info "Dont do"
                         }
                     }else  if (astatus.equals("PASS"))
                    {
                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                                                    {
                            //log.info "Dont do"
                         }
                     }
                                                                else
                                                                {
                                                ares='<font color="red">Failed</font>'
                                                                                                amsg="$myAssertion.errors"
                                                                                                if(amsg.contains('expecting '))
                                                                                                                amsg='Expecting'+amsg.split('expecting')[1]
                                                                                amsg=amsg.replaceAll("actual was","Actual").replaceAll("]]","]");
                                                                }
                                                                HTML_Body+='<TR><TD width="7%">Assertion</TD><TD width="40%">'+aname+'</TD><TD align="center" width="10%">'+ares+'</TD><TD width="25%">'+amsg+'</TD></TR>'
                }
                HTML_Body+='</TABLE></div>'
                HTML_Body+='<div id="target'+testCaseName+'_'+step+'ReqRes\" style=\"display:none\"><TABLE align=\"center\" ID=\"One\" class= \"class_name\" bgcolor=\"#AFEEEE\" border width =\"80%\"  cellspacing = 0 cellpadding = 2  style = \"border-left:solid 2px White;\"><TR><TD width = "40%" size="4" valign="top"><font color="blue" size="2"><b>REQUEST</b></font><br><br><pre>'+req.replaceAll("\n&amp;=","").replaceAll("<","&lt;").replaceAll(">","&gt;")+'</pre></TD><TD width = "40%" size="4" valign="top" ><font color="blue" size="2"><b>RESPONSE</b></font><br><br><pre>'+response.replaceAll("><",">\n<").replaceAll("<","&lt;").replaceAll(">","&gt;")+' </TD></TR></TABLE></div>'
          }
          else if(type=="datagen")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td></tr></Table><div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                                for (String p in it.getPropertyNames())

                     {
                                HTML_Body+='<TR><TD width="10%">Created Data</TD><TD width="35%">'+p+'</TD><TD align="center" width="35%">'+it.getPropertyValue(p)+'</TD></TR>'
                     }
                                HTML_Body+='</TABLE></div></Table>'
                }
          else if(type=="groovy")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%">'+StepName+'</td></tr></Table>'
                }
                }

            
                }catch(Exception e){}
                HTML_Body+='</div>'
                BODY.put(testCaseName,HTML_Body)
                HTML_Body = '';
             
}

for(TCs in TC)

HTML_Body += BODY.get(TCs)

TotalCases = OPass+OFail;

String      HTMLTable = '<br><br><table width="35%" border="1" margin="10,5,5,50"  align="center"><tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total API cases Executed</th><th bgcolor="#fefefe" width="50%">'+TotalCases+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Passed</th><th bgcolor="#fefefe" width="50%">'+OPass+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Failed</th><th bgcolor="#fefefe" width="50%">'+OFail+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Environment</th><th bgcolor="#fefefe" width="50%">'+context.expand('${#TestSuite#Environment}')+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Execution Time</th><th bgcolor="#fefefe" width="50%">'+ftt.format(new Date())+'</th></tr></table>'
String HTML_Starting2='<title>'+testSuite.name+' Automation Report</title></head><script> function showDiv(objectID) { var theElementStyle = document.getElementById(objectID);  if(theElementStyle.style.display == "none")  { theElementStyle.style.display = "block";  } else { theElementStyle.style.display = "none"; }  }</script><body bgcolor="#FFFAFA"><h1 align="center">'+testSuite.name+' Automation Report</h1><div id="chart_div" style="float:left"></div>'+HTMLTable+'<table align="center" width="80%" class="Report"  bgcolor="#ADE6F1" border="1" margin="10,5,5,50"><tr><th width="80%">Test Execution Results</th></tr></table>'                 
HTML_Final = HTML_Starting+'<script type="text/javascript">google.load(\'visualization\', \'1.0\', {\'packages\':[\'corechart\']});  google.setOnLoadCallback(drawChart);function drawChart() {var data = new google.visualization.DataTable(); data.addColumn(\'string\', \'Result\'); data.addColumn(\'number\', \'Count\');data.addRows([[\'PASS\', '+OPass+'],[\'FAIL\', '+OFail+'],]); var options = {\'title\':\'Overall Result\', \'width\':500, \'height\':300, \'backgroundColor\':\'fefefe\', \'colors\': [\'#009933\', \'#F00000\'], \'fontSize\': 15};var chart = new google.visualization.PieChart(document.getElementById(\'chart_div\'));chart.draw(data, options);}</script>'+HTML_Starting2+HTML_Body+HTML_Ending

String Filename = testSuite.name+"_"+ft.format(new Date())+".html"
File file = new File(ProjectPath+Filename);
boolean blnDeleted = file.delete();
FileWriter writer = new FileWriter(ProjectPath+Filename, true);
writer.write(HTML_Final);
writer.close();
log.info 'Scenario Over']]></con:tearDownScript>
  </con:testSuite>
  <con:testSuite id="e671a4e9-d8e9-4a6b-a62b-47f7518925b6" name="TestSuite DataDriven -Data from Excel sheet">
    <con:description>TestSuite generated for REST Service [https://reqres.in]</con:description>
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="c22c72de-b40e-499c-9b1c-d570e4d66c9b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase1_UserCreation" searchProperties="true">
      <con:settings/>
      <con:testStep type="properties" name="Properties" id="29b5357f-823d-45d3-931d-2c275613195f">
        <con:settings/>
        <con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:properties>
            <con:property>
              <con:name>Name</con:name>
              <con:value>George</con:value>
            </con:property>
            <con:property>
              <con:name>Job</con:name>
              <con:value>IT Profession</con:value>
            </con:property>
            <con:property>
              <con:name>Designation</con:name>
              <con:value>Architecture</con:value>
            </con:property>
            <con:property>
              <con:name>Location</con:name>
              <con:value>Finland</con:value>
            </con:property>
          </con:properties>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Groovy Script" id="c3f374ee-9b62-4ea6-a3cc-45b7440a80e9">
        <con:settings/>
        <con:config>
          <script>import groovy.util.*
import groovy.json.JsonSlurper

def res
def groovyUtils =new com.eviware.soapui.support.GroovyUtils(context)
def projectDir=groovyUtils.projectPath

File file=new File(projectDir)
//If you want hardcoding the location, pls use it directly -----> //D:\Self_Exploration
def fisrtLevelDir=file.getParent()
//log.info fisrtLevelDir
//consloe line will print for above statement as : D:\Self_Exploration 
def filePath= fisrtLevelDir + "\\SoapUI\\TestData.csv" 
//log.info filePath
//consloe line will print for above statement as :D:\Self_Exploration\SoapUI\TestData.csv

context.fileReader =new BufferedReader(new FileReader(filePath))

rows=context.fileReader.readLines()
int n=rows.size()

for (int i=1;i &lt;n;i++){
	row=rows[i]
	String[] data=row.split(",")

	//Set the Property value
	testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Name",data[0])
	testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Job",data[1])
	testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Designation",data[2])
	testRunner.testCase.getTestStepByName("Properties").setPropertyValue("Location",data[3])

	//run the step
	testRunner.runTestStepByName("POST-Create Users")

	res=context.expand('${POST-Create Users#Response}')
	obj=new JsonSlurper().parseText(res)

	log.info obj

	//assert
	assert obj.Name==data[0]
	assert obj.Job==data[1]
	assert obj.Designation==data[2]
	assert obj.Location==data[3]
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="POST-Create Users" id="e3c96dcd-a112-40b6-a029-6992fe383531" disabled="true">
        <con:settings/>
        <con:config service="https://reqres.in" resourcePath="/api/users" methodName="POST Request" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="POST-Create Users" id="427c2263-d04f-4e61-8430-db65d0481438" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://reqres.in</con:endpoint>
            <con:request>{
    "Name": "${Properties#Name}",
    "Job": "${Properties#Job}",
    "Designation": "${Properties#Designation}",
    "Location": "${Properties#Location}"
}</con:request>
            <con:originalUri>https://reqres.in/api/users</con:originalUri>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties/>
    </con:testCase>
    <con:properties/>
    <con:tearDownScript><![CDATA[import java.util.Date
import java.text.SimpleDateFormat
import com.eviware.soapui.support.XmlHolder
SimpleDateFormat ft = new SimpleDateFormat ("dd-MM-yyyy_HHmmss");
SimpleDateFormat ftt = new SimpleDateFormat ("dd-MM-yyyy hh:mm:ss a");
String ProjectPath = context.expand('${projectDir}') + "\\" + testSuite.project.name + "\\"
String HTML_Starting = '<html><head><style>.tooltip{position:absolute;margin:5px;width:200px;height:50px;border:1px solid black;display:none;background-color: #FFFFFF}</style><script>function showTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "block";}function hideTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "none";}</script><script type="text/javascript" src="https://www.google.com/jsapi"></script>'               
String HTML_Ending   = '</body></html>'
String HTML_Body     = ''
String HTML_Final    = '';
int OPass = 0;
int OFail = 0;
int TotalCases = 0;
ArrayList<String> TC = new ArrayList<String>();
HashMap<String,String> BODY = new HashMap<String,String>()

log.info 'Start '+ runner.results

runner.results.each
{    testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
                TC.add(testCaseName)
}

Collections.sort(TC)
int TestcaseNO = 1;
runner.results.each

{   

  try{
                testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
     String testCaseName=testCaseName
     String testCaseDesc=testCaseResult.getTestCase().getDescription()
     String testCaseID = testCaseName
     if(testCaseID.contains('BUG'))testCaseID=testCaseID.split('\\[')[0]
     if(testCaseDesc==null||testCaseDesc=='')testCaseDesc=testCaseName
     //if(testCaseName.equalsIgnoreCase(testCaseDesc))testCaseID = 'TestCase '+TestcaseNO
     //TestcaseNO+=1;
	 
     log.info 'Test case result '+testCaseResult.getStatus()
                if(testCaseResult.getStatus().toString().contains("FINISHED")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else if(testCaseResult.getStatus().toString().contains("PASS")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else{
                                                String summarysize='50';
                                                String BUGS='';
                                                if(testCaseResult.getTestCase().name.toString().contains('BUG'))
                                                {
                                                                BUGS='<table>';
                                                                summarysize='40';
                                                                String Buglist = testCaseResult.getTestCase().name.toString().split('\\[')[1].split('\\]')[0];
                                                                ArrayList bugsl = new ArrayList();
                                                                if(Buglist.contains(','))bugsl=Buglist.split(',')
                                                                for(String bl : bugsl)
                                                                BUGS+='<tr><td><a target="_blank" href="https://ariasystems.atlassian.net/browse/'+bl+'">'+bl+'</a></td></tr>';
                                                                BUGS+='</table>';
                                                                BUGS='<TD width = "10%" bgcolor=white align="center" onmouseover="showTool(\'target'+testCaseName+'BUG(s)\');return false;" onmouseout="hideTool(\'target'+testCaseName+'BUG(s)\');return false;"><font color="red"><b>BUG(s)</b></font><div id="target'+testCaseName+'BUG(s)" style="display:none" class = "tooltip">'+BUGS+'</div></TD>';
                                                }
                                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#C20000" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "'+summarysize+'%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td>'+BUGS+'</tr></TABLE><div id="target'+testCaseName+'" style="display:none">';
                                                OFail+=1;
                     }

                int step=0;
                testCaseResult.getTestCase().testStepList.each
                {                             
                                String type=it.config.type
                                String StepName=it.name
          String req = '';
          String response    
                                if(type=="request"  || type=="httprequest" || type=="jdbc")

          {    step+=1;
                if(type=="request")
               {
               req  = it.getTestRequest().response.getRequestContent() ;
               response=it.getProperty('Response').getValue()
               }
               else if (type=="httprequest")
               {
                     String propFinal=''
                     def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password','Response','Username']
                     for (String p in it.getPropertyNames())
                     {
                                if(!propToRemove.contains(p) && it.getPropertyValue(p)!='')
                                                propFinal=propFinal+p +": "+it.getPropertyValue(p)+"\n"
                     }
                     req = propFinal.replaceAll(",","\n")
                     response=it.getProperty('Response').getValue()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
                response = it.getProperty('ResponseAsXml').getValue().toString()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
               def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password']
                    response = it.getProperty('ResponseAsXml').getValue().toString()
               }

               String StepResult = 'Passed'
               log.info  'Step results '+it.assertionStatus.toString()
               if(it.assertionStatus.toString().contains("UNKNOWN")){
              StepResult = '<td width="25%" align="center"><font color="orange"><b>No Assertion</b></font></TD>'
               } else if(it.assertionStatus.toString().contains("VALID"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
                else if(it.assertionStatus.toString().contains("PASS"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
               else
               StepResult = '<td width="25%" align="center"><font color="red"><b>Failed</b></font></TD>'
               HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "11%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td><td><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'ReqRes\');return false;" size ="1">Request/Response</a>&emsp;&emsp;&emsp;' + it.testRequest.response.timeTaken+'ms</TD>'+StepResult
                                                HTML_Body+='</TR></TABLE>'

                HTML_Body+='<div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                it.getAssertionList().each
                                {
                                myAssertion->
                                String aname="$myAssertion.label"
                                                                String astatus="$myAssertion.status"
                                                                String amsg=""
                                                                log.info 'Assertion Result '+ astatus
                                                                if (astatus.equals("VALID"))
                    {

                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                         {
                            //log.info "Dont do"
                         }
                     }else  if (astatus.equals("PASS"))
                    {
                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                                                    {
                            //log.info "Dont do"
                         }
                     }
                                                                else
                                                                {
                                                ares='<font color="red">Failed</font>'
                                                                                                amsg="$myAssertion.errors"
                                                                                                if(amsg.contains('expecting '))
                                                                                                                amsg='Expecting'+amsg.split('expecting')[1]
                                                                                amsg=amsg.replaceAll("actual was","Actual").replaceAll("]]","]");
                                                                }
                                                                HTML_Body+='<TR><TD width="7%">Assertion</TD><TD width="40%">'+aname+'</TD><TD align="center" width="10%">'+ares+'</TD><TD width="25%">'+amsg+'</TD></TR>'
                }
                HTML_Body+='</TABLE></div>'
                HTML_Body+='<div id="target'+testCaseName+'_'+step+'ReqRes\" style=\"display:none\"><TABLE align=\"center\" ID=\"One\" class= \"class_name\" bgcolor=\"#AFEEEE\" border width =\"80%\"  cellspacing = 0 cellpadding = 2  style = \"border-left:solid 2px White;\"><TR><TD width = "40%" size="4" valign="top"><font color="blue" size="2"><b>REQUEST</b></font><br><br><pre>'+req.replaceAll("\n&amp;=","").replaceAll("<","&lt;").replaceAll(">","&gt;")+'</pre></TD><TD width = "40%" size="4" valign="top" ><font color="blue" size="2"><b>RESPONSE</b></font><br><br><pre>'+response.replaceAll("><",">\n<").replaceAll("<","&lt;").replaceAll(">","&gt;")+' </TD></TR></TABLE></div>'
          }
          else if(type=="datagen")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td></tr></Table><div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                                for (String p in it.getPropertyNames())

                     {
                                HTML_Body+='<TR><TD width="10%">Created Data</TD><TD width="35%">'+p+'</TD><TD align="center" width="35%">'+it.getPropertyValue(p)+'</TD></TR>'
                     }
                                HTML_Body+='</TABLE></div></Table>'
                }
          else if(type=="groovy")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%">'+StepName+'</td></tr></Table>'
                }
                }

            
                }catch(Exception e){}
                HTML_Body+='</div>'
                BODY.put(testCaseName,HTML_Body)
                HTML_Body = '';
             
}

for(TCs in TC)

HTML_Body += BODY.get(TCs)

TotalCases = OPass+OFail;

String      HTMLTable = '<br><br><table width="35%" border="1" margin="10,5,5,50"  align="center"><tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total API cases Executed</th><th bgcolor="#fefefe" width="50%">'+TotalCases+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Passed</th><th bgcolor="#fefefe" width="50%">'+OPass+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Failed</th><th bgcolor="#fefefe" width="50%">'+OFail+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Environment</th><th bgcolor="#fefefe" width="50%">'+context.expand('${#TestSuite#Environment}')+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Execution Time</th><th bgcolor="#fefefe" width="50%">'+ftt.format(new Date())+'</th></tr></table>'
String HTML_Starting2='<title>'+testSuite.name+' Automation Report</title></head><script> function showDiv(objectID) { var theElementStyle = document.getElementById(objectID);  if(theElementStyle.style.display == "none")  { theElementStyle.style.display = "block";  } else { theElementStyle.style.display = "none"; }  }</script><body bgcolor="#FFFAFA"><h1 align="center">'+testSuite.name+' Automation Report</h1><div id="chart_div" style="float:left"></div>'+HTMLTable+'<table align="center" width="80%" class="Report"  bgcolor="#ADE6F1" border="1" margin="10,5,5,50"><tr><th width="80%">Test Execution Results</th></tr></table>'                 
HTML_Final = HTML_Starting+'<script type="text/javascript">google.load(\'visualization\', \'1.0\', {\'packages\':[\'corechart\']});  google.setOnLoadCallback(drawChart);function drawChart() {var data = new google.visualization.DataTable(); data.addColumn(\'string\', \'Result\'); data.addColumn(\'number\', \'Count\');data.addRows([[\'PASS\', '+OPass+'],[\'FAIL\', '+OFail+'],]); var options = {\'title\':\'Overall Result\', \'width\':500, \'height\':300, \'backgroundColor\':\'fefefe\', \'colors\': [\'#009933\', \'#F00000\'], \'fontSize\': 15};var chart = new google.visualization.PieChart(document.getElementById(\'chart_div\'));chart.draw(data, options);}</script>'+HTML_Starting2+HTML_Body+HTML_Ending

String Filename = testSuite.name+"_"+ft.format(new Date())+".html"
File file = new File(ProjectPath+Filename);
boolean blnDeleted = file.delete();
FileWriter writer = new FileWriter(ProjectPath+Filename, true);
writer.write(HTML_Final);
writer.close();
log.info 'Scenario Over']]></con:tearDownScript>
  </con:testSuite>
  <con:properties/>
  <con:afterLoadScript><![CDATA[import java.util.Date
import java.text.SimpleDateFormat
import com.eviware.soapui.support.XmlHolder
SimpleDateFormat ft = new SimpleDateFormat ("dd-MM-yyyy_HHmmss");
SimpleDateFormat ftt = new SimpleDateFormat ("dd-MM-yyyy hh:mm:ss a");
String ProjectPath = context.expand('${projectDir}') + "\\" + testSuite.project.name + "\\"
String HTML_Starting = '<html><head><style>.tooltip{position:absolute;margin:5px;width:200px;height:50px;border:1px solid black;display:none;background-color: #FFFFFF}</style><script>function showTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "block";}function hideTool(objectID){ var theElementStyle = document.getElementById(objectID);theElementStyle.style.display = "none";}</script><script type="text/javascript" src="https://www.google.com/jsapi"></script>'               
String HTML_Ending   = '</body></html>'
String HTML_Body     = ''
String HTML_Final    = '';
int OPass = 0;
int OFail = 0;
int TotalCases = 0;
ArrayList<String> TC = new ArrayList<String>();
HashMap<String,String> BODY = new HashMap<String,String>()

log.info 'Start '+ runner.results

runner.results.each
{    testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
                TC.add(testCaseName)
}

Collections.sort(TC)
int TestcaseNO = 1;
runner.results.each

{   

  try{
                testCaseResult = it
                testCaseName = testCaseResult.getTestCase().name
     String testCaseName=testCaseName
     String testCaseDesc=testCaseResult.getTestCase().getDescription()
     String testCaseID = testCaseName
     if(testCaseID.contains('BUG'))testCaseID=testCaseID.split('\\[')[0]
     if(testCaseDesc==null||testCaseDesc=='')testCaseDesc=testCaseName
     //if(testCaseName.equalsIgnoreCase(testCaseDesc))testCaseID = 'TestCase '+TestcaseNO
     //TestcaseNO+=1;
	 
     log.info 'Test case result '+testCaseResult.getStatus()
                if(testCaseResult.getStatus().toString().contains("FINISHED")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else if(testCaseResult.getStatus().toString().contains("PASS")){HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#65C400" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "50%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td></TR></TABLE><div id="target'+testCaseName+'" style="display:none">';OPass+=1;}
                else{
                                                String summarysize='50';
                                                String BUGS='';
                                                if(testCaseResult.getTestCase().name.toString().contains('BUG'))
                                                {
                                                                BUGS='<table>';
                                                                summarysize='40';
                                                                String Buglist = testCaseResult.getTestCase().name.toString().split('\\[')[1].split('\\]')[0];
                                                                ArrayList bugsl = new ArrayList();
                                                                if(Buglist.contains(','))bugsl=Buglist.split(',')
                                                                for(String bl : bugsl)
                                                                BUGS+='<tr><td><a target="_blank" href="https://ariasystems.atlassian.net/browse/'+bl+'">'+bl+'</a></td></tr>';
                                                                BUGS+='</table>';
                                                                BUGS='<TD width = "10%" bgcolor=white align="center" onmouseover="showTool(\'target'+testCaseName+'BUG(s)\');return false;" onmouseout="hideTool(\'target'+testCaseName+'BUG(s)\');return false;"><font color="red"><b>BUG(s)</b></font><div id="target'+testCaseName+'BUG(s)" style="display:none" class = "tooltip">'+BUGS+'</div></TD>';
                                                }
                                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#C20000" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "10%" align="center" ><font color="white">'+testCaseID+'</font></TD><TD width = "'+summarysize+'%" onClick="showDiv(\'target'+testCaseName+'\');return false;" ><font color="white">'+testCaseDesc+'</font></td>'+BUGS+'</tr></TABLE><div id="target'+testCaseName+'" style="display:none">';
                                                OFail+=1;
                     }

                int step=0;
                testCaseResult.getTestCase().testStepList.each
                {                             
                                String type=it.config.type
                                String StepName=it.name
          String req = '';
          String response    
                                if(type=="request"  || type=="httprequest" || type=="jdbc")

          {    step+=1;
                if(type=="request")
               {
               req  = it.getTestRequest().response.getRequestContent() ;
               response=it.getProperty('Response').getValue()
               }
               else if (type=="httprequest")
               {
                     String propFinal=''
                     def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password','Response','Username']
                     for (String p in it.getPropertyNames())
                     {
                                if(!propToRemove.contains(p) && it.getPropertyValue(p)!='')
                                                propFinal=propFinal+p +": "+it.getPropertyValue(p)+"\n"
                     }
                     req = propFinal.replaceAll(",","\n")
                     response=it.getProperty('Response').getValue()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
                response = it.getProperty('ResponseAsXml').getValue().toString()
               }
               else if (type=="jdbc")
               {
               req = it.getQuery()
               def propToRemove = ['RawRequest','ResponseAsXml','Endpoint','Domain','Password']
                    response = it.getProperty('ResponseAsXml').getValue().toString()
               }

               String StepResult = 'Passed'
               log.info  'Step results '+it.assertionStatus.toString()
               if(it.assertionStatus.toString().contains("UNKNOWN")){
              StepResult = '<td width="25%" align="center"><font color="orange"><b>No Assertion</b></font></TD>'
               } else if(it.assertionStatus.toString().contains("VALID"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
                else if(it.assertionStatus.toString().contains("PASS"))
               StepResult = '<td width="25%" align="center"><font color="green"><b>Passed</b></font></TD>'
               else
               StepResult = '<td width="25%" align="center"><font color="red"><b>Failed</b></font></TD>'
               HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "11%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td><td><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'ReqRes\');return false;" size ="1">Request/Response</a>&emsp;&emsp;&emsp;' + it.testRequest.response.timeTaken+'ms</TD>'+StepResult
                                                HTML_Body+='</TR></TABLE>'

                HTML_Body+='<div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                it.getAssertionList().each
                                {
                                myAssertion->
                                String aname="$myAssertion.label"
                                                                String astatus="$myAssertion.status"
                                                                String amsg=""
                                                                log.info 'Assertion Result '+ astatus
                                                                if (astatus.equals("VALID"))
                    {

                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                         {
                            //log.info "Dont do"
                         }
                     }else  if (astatus.equals("PASS"))
                    {
                      ares='<font color="green">Passed</font>'
                      String asertType="$myAssertion.ID"
                      //log.info "asertType"+asertType
                      if(asertType.contains("GroovyScriptAssertion"))  
                         {                                                                            
                           //log.info "CHKECSC"+"$myAssertion.scriptText"
                           amsg=""
                         }
                      else if(asertType.contains("ProXPathContainsAssertion")==false  && asertType.contains("SOAP") ==false)
                         {
                           //log.info "CHECK "+"$myAssertion.expectedContent"
                           amsg="$myAssertion.expectedContent"
                         }
                      else
                                                                                    {
                            //log.info "Dont do"
                         }
                     }
                                                                else
                                                                {
                                                ares='<font color="red">Failed</font>'
                                                                                                amsg="$myAssertion.errors"
                                                                                                if(amsg.contains('expecting '))
                                                                                                                amsg='Expecting'+amsg.split('expecting')[1]
                                                                                amsg=amsg.replaceAll("actual was","Actual").replaceAll("]]","]");
                                                                }
                                                                HTML_Body+='<TR><TD width="7%">Assertion</TD><TD width="40%">'+aname+'</TD><TD align="center" width="10%">'+ares+'</TD><TD width="25%">'+amsg+'</TD></TR>'
                }
                HTML_Body+='</TABLE></div>'
                HTML_Body+='<div id="target'+testCaseName+'_'+step+'ReqRes\" style=\"display:none\"><TABLE align=\"center\" ID=\"One\" class= \"class_name\" bgcolor=\"#AFEEEE\" border width =\"80%\"  cellspacing = 0 cellpadding = 2  style = \"border-left:solid 2px White;\"><TR><TD width = "40%" size="4" valign="top"><font color="blue" size="2"><b>REQUEST</b></font><br><br><pre>'+req.replaceAll("\n&amp;=","").replaceAll("<","&lt;").replaceAll(">","&gt;")+'</pre></TD><TD width = "40%" size="4" valign="top" ><font color="blue" size="2"><b>RESPONSE</b></font><br><br><pre>'+response.replaceAll("><",">\n<").replaceAll("<","&lt;").replaceAll(">","&gt;")+' </TD></TR></TABLE></div>'
          }
          else if(type=="datagen")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%"><a href="#" onClick="showDiv(\'target'+testCaseName+'_'+step+'\');return false;">'+StepName+'</a></td></tr></Table><div id="target'+testCaseName+'_'+step+'\" style=\"display:none\"><TABLE align="center" ID="One" class= "class_name" bgcolor="#FFFAF0" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;">'
                                for (String p in it.getPropertyNames())

                     {
                                HTML_Body+='<TR><TD width="10%">Created Data</TD><TD width="35%">'+p+'</TD><TD align="center" width="35%">'+it.getPropertyValue(p)+'</TD></TR>'
                     }
                                HTML_Body+='</TABLE></div></Table>'
                }
          else if(type=="groovy")
                {
                                step+=1;
                                HTML_Body+='<TABLE align="center" ID="One" class= "class_name" bgcolor="#E5E4E2" border width ="80%"  cellspacing = 0 cellpadding = 2  style = "border-left:solid 2px White;"><TR><TD width = "5%" >Step '+step+'</TD><TD width = "40%">'+StepName+'</td></tr></Table>'
                }
                }

            
                }catch(Exception e){}
                HTML_Body+='</div>'
                BODY.put(testCaseName,HTML_Body)
                HTML_Body = '';
             
}

for(TCs in TC)

HTML_Body += BODY.get(TCs)

TotalCases = OPass+OFail;

String      HTMLTable = '<br><br><table width="35%" border="1" margin="10,5,5,50"  align="center"><tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total API cases Executed</th><th bgcolor="#fefefe" width="50%">'+TotalCases+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Passed</th><th bgcolor="#fefefe" width="50%">'+OPass+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Total Cases Failed</th><th bgcolor="#fefefe" width="50%">'+OFail+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Environment</th><th bgcolor="#fefefe" width="50%">'+context.expand('${#TestSuite#Environment}')+'</th></tr>'
HTMLTable = HTMLTable + '<tr width="100%" align="left"><th bgcolor="#fefefe" width="50%">Execution Time</th><th bgcolor="#fefefe" width="50%">'+ftt.format(new Date())+'</th></tr></table>'
String HTML_Starting2='<title>'+testSuite.name+' Automation Report</title></head><script> function showDiv(objectID) { var theElementStyle = document.getElementById(objectID);  if(theElementStyle.style.display == "none")  { theElementStyle.style.display = "block";  } else { theElementStyle.style.display = "none"; }  }</script><body bgcolor="#FFFAFA"><h1 align="center">'+testSuite.name+' Automation Report</h1><div id="chart_div" style="float:left"></div>'+HTMLTable+'<table align="center" width="80%" class="Report"  bgcolor="#ADE6F1" border="1" margin="10,5,5,50"><tr><th width="80%">Test Execution Results</th></tr></table>'                 
HTML_Final = HTML_Starting+'<script type="text/javascript">google.load(\'visualization\', \'1.0\', {\'packages\':[\'corechart\']});  google.setOnLoadCallback(drawChart);function drawChart() {var data = new google.visualization.DataTable(); data.addColumn(\'string\', \'Result\'); data.addColumn(\'number\', \'Count\');data.addRows([[\'PASS\', '+OPass+'],[\'FAIL\', '+OFail+'],]); var options = {\'title\':\'Overall Result\', \'width\':500, \'height\':300, \'backgroundColor\':\'fefefe\', \'colors\': [\'#009933\', \'#F00000\'], \'fontSize\': 15};var chart = new google.visualization.PieChart(document.getElementById(\'chart_div\'));chart.draw(data, options);}</script>'+HTML_Starting2+HTML_Body+HTML_Ending

String Filename = testSuite.name+"_"+ft.format(new Date())+".html"
File file = new File(ProjectPath+Filename);
boolean blnDeleted = file.delete();
FileWriter writer = new FileWriter(ProjectPath+Filename, true);
writer.write(HTML_Final);
writer.close();
log.info 'Scenario Over']]></con:afterLoadScript>
  <con:wssContainer/>
  <con:oAuth2ProfileContainer/>
  <con:oAuth1ProfileContainer/>
  <con:sensitiveInformation/>
</con:soapui-project>